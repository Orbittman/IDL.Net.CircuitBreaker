<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Idl.net.circuitbreaker by InvitationDigital</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Idl.net.circuitbreaker</h1>
          <h2>Circuit breaker implementation using a time stamp to reset the circuit</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/InvitationDigital/IDL.Net.CircuitBreaker/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/InvitationDigital/IDL.Net.CircuitBreaker/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/InvitationDigital/IDL.Net.CircuitBreaker" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <p><a href="https://www.myget.org/"><img src="https://www.myget.org/BuildSource/Badge/idl-public?identifier=95c60c91-9607-478d-b51a-679426498ab6" alt="idl-public MyGet Build Status"></a></p>

<h1>
<a id="idlnetcircuitbreaker" class="anchor" href="#idlnetcircuitbreaker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>IDL.Net.CircuitBreaker</h1>

<p>This is a simple circuit breaker library with the ability to maintain the state outside of the circuit class itself. This allows it to be used in an environment where multiple typed responses are required but using a single circuit state for all of them. </p>

<p>We needed to not have a timer that would reset the circuit but have that based on a timestamp. This way a new circuit could be interrogated at any point and evaluate it's state based on the CircuitState object that was passed to the operation excecution.</p>

<p>The circuit state maintains the position of the circuit Open | Half open | Closed, the current failure count and a time that the circuit is reset. </p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> state = <span class="pl-k">new</span> CircuitState();
<span class="pl-k">var</span> circuit = <span class="pl-k">new</span> Circuit&lt;TResponse&gt;(<span class="pl-c1">2</span>, TimeSpan.FromSeconds(<span class="pl-c1">5</span>), state);

<span class="pl-k">for</span>(<span class="pl-k">int</span> i = <span class="pl-c1">0</span>; i &lt; <span class="pl-c1">6</span>; i++)
{
   <span class="pl-k">try</span>
   {
      circuit.Execute(() =&gt; { <span class="pl-k">throw</span> <span class="pl-k">new</span> Exception());
   }
   <span class="pl-k">catch</span>(CircuitOpenException)
   {
      Console.WriteLine(<span class="pl-s"><span class="pl-pds">"</span>The circuit is now open<span class="pl-pds">"</span></span>);
   }
   <span class="pl-k">catch</span>(Exception)
   {
      Console.WriteLine(<span class="pl-s"><span class="pl-pds">"</span>The circuit is closed<span class="pl-pds">"</span></span>);
   }
}</pre></div>

<p>This will output:<br>
The circuit is closed<br>
The circuit is closed
The circuit is now open  </p>

<p>After 5 seconds the circuit will become 'half open' and allow one more request before entering the open state again. If the circuit operation is successful the circuit will close and the failure count reset.</p>

<div class="highlight highlight-source-cs"><pre>Thread.Sleep(<span class="pl-c1">5000</span>);
Console.WriteLine(state.State);
<span class="pl-c">// outputs "HalfOpen"</span>

circuit = <span class="pl-k">new</span> Circuit&lt;<span class="pl-k">string</span>&gt;(<span class="pl-c1">2</span>, TimeSpan.FromSeconds(<span class="pl-c1">5</span>), state);
Console.WriteLine(circuit.Execute(() =&gt; <span class="pl-s"><span class="pl-pds">"</span>Test passed<span class="pl-pds">"</span></span>));
<span class="pl-c">// outputs "Test passed"</span>

Console.WriteLine(state.State);
<span class="pl-c">// outputs "Closed"</span></pre></div>

<p>For asynchronous operations use</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> state = <span class="pl-k">new</span> CircuitState();
<span class="pl-k">var</span> circuit = <span class="pl-k">new</span> Circuit&lt;TResponse&gt;(<span class="pl-c1">2</span>, TimeSpan.FromSeconds(<span class="pl-c1">5</span>), state);
<span class="pl-k">var</span> asyncResponse = circuit.ExecuteAsync(() =&gt; Task.Run(() =&gt; {}))</pre></div>
        </section>

        <footer>
          Idl.net.circuitbreaker is maintained by <a href="https://github.com/InvitationDigital">InvitationDigital</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
